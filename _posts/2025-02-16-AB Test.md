---
title: AB Test学习笔记
description:
date: 2025-02-16 21:00:00 +0800
categories: [learn]
tags: [AB Test]
---

# AB Test学习笔记

## 基本概念
AB Test是一种通过控制变量和随机分组测试，从而推断出因果关系和量化效果的科学试验方法，同时有效规避因普森北仑的错误决策。

### 常用优化项
- UI展现/文案内容/页面布局
- 推荐算法/策略参数

### 不适用场景
1. 实验数据太少或者试验周期太长，AB实验可能很久都不会显著
2. 影响用户体验、价格调整、激励变化等不适宜做AB实验

## 流量分配原则(分桶/分层)

### 1. 同层互斥
在同个实验中，不同实验组的流量是独立互斥的，对于任意一个用户，有且只能在一个桶中出现。

### 2. 分层正交(流量复用)
每个独立实验每一层，每个桶的流量穿越每层实验时，都会随机打散再重组(hash(设备id/用户id + 层id))，目的是减少不同层之间的实验干扰。

分层流量分配示意：

| 层级   | 实验名称   | 分组                             | 流量占比                 | 分组原理               |
| ------ | ---------- | -------------------------------- | ------------------------ | ---------------------- |
| Layer1 | 首页改版   | A组<br>B组<br>对照组             | 33%<br>33%<br>34%        | hash(uid+layer1) % 100 |
| ↓      | (重新hash) | ↓                                | ↓                        | ↓                      |
| Layer2 | 推荐算法   | 测试组<br>对照组                 | 50%<br>50%               | hash(uid+layer2) % 100 |
| ↓      | (重新hash) | ↓                                | ↓                        | ↓                      |
| Layer3 | 价格策略   | 版本1<br>版本2<br>版本3<br>版本4 | 25%<br>25%<br>25%<br>25% | hash(uid+layer3) % 100 |

特点说明：
- 每一层的用户分组互相独立
- 不同层级间通过重新hash打散流量
- 同一用户在不同层可能属于不同组

同层互斥和分层正交都是为了保证流量的同质性，避免辛普森悖论。

辛普森悖论示例

| 科室   | 治疗方案 | 存活人数 | 总人数 | 存活率 |
| ------ | -------- | -------- | ------ | ------ |
| 轻症科 | 方案A    | 90       | 100    | 90%    |
| 轻症科 | 方案B    | 80       | 100    | 80%    |
| 重症科 | 方案A    | 2        | 10     | 20%    |
| 重症科 | 方案B    | 5        | 10     | 50%    |
| 总计   | 方案A    | 92       | 110    | 83.6%  |
| 总计   | 方案B    | 85       | 110    | 77.3%  |

从表中可以看出：
- 在轻症科中，方案A(90%)优于方案B(80%)
- 在重症科中，方案B(50%)优于方案A(20%)
- 但在总体上，方案A(83.6%)反而优于方案B(77.3%)

## 实验流程

### 策略设定
1. 选定北极星指标、辅助指标、用户分组
2. 确定数据量大小、桶的数量、切流百分比（工具测算）
3. 确定测试时长（工具测算）
4. 确定置信度，p值（工具测算）

### 实验步骤
1. 在AB测试平台，创建测试流量组，创建实验id、实验下的分组id
2. 前/后端配置实验及分组策略，调用AB测试平台的接口，得到当前用户属于哪个分组，进行流量切分，数据打点
3. 测试，通过数据工具查看结果

## 实战举例
通过AB实现找到最优返利比例
### 1. 确定实验策略
- 返利比例设置：设置不同的返利比例（如0%、5%、10%、15%），通过AB实验找到最优解
- 用户画像：提前为用户打上付费标签(0氪/大R/...)，区分不同付费层级的用户
- 用户分层：针对不同付费层级的用户分别进行实验，确保实验结果的准确性

### 2. 实验设计与执行
- 多返利比例控制：通过类似"翻牌"的方式，让用户选择不同的返利比例，背后由平台控制实际的返利比例，避免用户投诉
- 用户生命周期管理：构建用户生命周期模型，针对流失用户设计长效的充值优惠机制，避免羊毛党

### 3. 数据评估
- 关键指标：用户充值金额、付费率、ARPPU（每用户平均收入）、续充率、成本率等
- 显著性检验：通过p值和置信区间判断实验结果的显著性

注意事项：
- 剔除大R用户的影响，避免少数用户对整体结果的干扰
- 确保实验组和对照组的公平性，避免数据偏差

### 4. 数据验证
- 实验前验证：在实验前验证实验组和对照组的初始数据是否一致（空跑），确保实验结果的可靠性
- 实验后验证：实验结束后，再次验证数据，确保实验结果的准确性

### 5. 决策与优化
- 最优解选择：根据实验结果，选择最优的返利比例
- 全量覆盖：将最优返利比例应用到全量用户，进一步提升平台收益